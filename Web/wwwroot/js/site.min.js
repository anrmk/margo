$.fn.disabled=function(){$(this).attr("disabled","disabled")};$.fn.enabled=function(){$(this).removeAttr("disabled")};class DocumentController{constructor(n,t=()=>{}){this.options=$.extend(!0,{table:"#table",filter:"#table-filter",controller:{list:"","delete":""},columns:[],selected:[],onRowClick:()=>{},onDblRowClick:()=>{}},n);this.table=$(this.options.table);this.toolbar=$(this.table.data("toolbar"));this.filter=$(this.options.filter);this.datatable=this.table.DataTable({ajax:{url:this.options.controller.list,contentType:"application/json; charset=utf-8",data:n=>n},columns:this.options.columns,rowCallback:(n,t)=>{$.inArray(t.id,this.options.selected)!==-1&&$(n).find("input[type=checkbox]").attr("checked",!0)}});this.initialize();this.callback=t}initialize(){var n=this.table.find("tbody");this.toolbar.find("button[data-action=delete]").on("click",n=>this.remove(n));n.on("click","tr",n=>{var t=$(n.currentTarget),i=this.datatable.row(t);t.hasClass("active")?t.removeClass("active"):(this.table.find("tr.active").removeClass("active"),t.addClass("active"));this.options.onRowClick(n,i.data())});n.on("dblclick","tr",n=>{var t=this.datatable.row(n.currentTarget);this.options.onDblRowClick(n,t.data())});n.on("change","input",n=>{var r=$(n.currentTarget),t=Number(r.val()),i=$.inArray(t,this.options.selected);i===-1?this.options.selected.push(t):this.options.selected.splice(i,1);this.options.selected.length>0?this.toolbar.find("button[data-action=delete]").enabled():this.toolbar.find("button[data-action=delete]").disabled()})}remove(){if(!confirm("Are you sure want to delete this?"))return!1;var n={url:this.options.controller.delete,data:{id:this.options.selected},traditional:!0,contentType:"application/json; charset=utf-8",complete:(n,t)=>{if(t==="success"){var i=this.options.selected.map(n=>"#row_"+n);this.datatable.rows(i).remove().draw(!1);this.options.selected=[]}}};$.ajax(n)}}class TreeViewController{constructor(n,t=()=>{}){this.options=$.extend(!0,{target:"#treeview",filter:"#treeview-filter",controller:{list:"","delete":""},columns:[],selected:[],onRowClick:()=>{},onDblRowClick:()=>{}},n);this.target=$(this.options.target).addClass("fancytree-connectors");this.toolbar=$(`<div class='ui stackable grid'>
                            <div class='row'>
                                <div class='eight wide column' data-id='toolbar'></div>
                                <div class='right aligned eight wide column'>
                                    <div class='ui form'>
                                        <input type='search' name='search' incremental placeholder='Search text' autocomplete='off' />
                                    </div>
                                </div>
                            </div>
                        </div>`).insertBefore(this.target);$(this.target.data("toolbar")).appendTo(this.toolbar.find("div[data-id=toolbar]"));this.filter=$(this.options.filter);this.treeview=this.target.fancytree({checkbox:!0,icon:!1,source:{url:this.options.controller.list,contentType:"application/json; charset=utf-8",data:n=>({id:n.id})},postProcess:(n,t)=>{t.result=this._convert(t.response.data)},activate:(n,t)=>{this.options.onRowClick(n,t.node.data)},dblclick:(n,t)=>{this.options.onDblRowClick(n,t.node.data)},select:(n,t)=>{this.options.selected=t.tree.getSelectedNodes().map(n=>n.key),this.options.selected.length>0?this.toolbar.find("button[data-action=delete]").enabled():this.toolbar.find("button[data-action=delete]").disabled()}});this.initialize();this.callback=t}initialize(){var n=this.target.find("tbody");this.toolbar.find("button[data-action=delete]").on("click",n=>this.remove(n));this.toolbar.find("input[name=search]").on("change search",n=>{if(n.type!=="change"||n.target.onsearch===undefined){var t,i=$.ui.fancytree.getTree(),r=$.trim($(n.target).val());t=i.filterNodes(r,{mode:"hide"});$("span.matches").text(t?"("+t+" matches)":"")}})}reload(){var n=this.treeview.fancytree("getTree");n.reload()}remove(){if(!confirm("Are you sure want to delete this?"))return!1;var n={url:this.options.controller.delete,data:{id:this.options.selected},traditional:!0,contentType:"application/json; charset=utf-8",complete:(n,t)=>{t==="success"&&(this.reload(),this.options.selected=[])}};$.ajax(n)}_convert(n){var t,i={};return $.each(n,function(n,t){i[t.id]=t}),n=$.map(n,function(n){return(n.key=n.id,n.title=n.name,n.expanded=!0,n.parentId)?(t=i[n.parentId],t.children?t.children.push(n):t.children=[n],null):n}),$.each(n,function(n,t){t.children&&t.children.length>1&&t.children.sort(function(n,t){return n.position<t.position?-1:n.position>t.position?1:0})}),n}}$.fn.ajaxSubmit=function(n={}){this.on("submit",t=>{t.preventDefault();var i=$(t.currentTarget),r=$.extend({url:i.attr("action"),type:i.attr("method"),data:JSON.stringify(i.serializeJSON()),processData:!1,contentType:"application/json; charset=utf-8",complete:(n,t)=>{i.removeClass("loading").trigger("ajaxSubmitComplete",[n,t])}},n);i.addClass("loading");$.ajax(r)}).on("ajaxSubmitComplete",(n,t,i)=>{n.preventDefault();var r=$(n.currentTarget).attr("rel")||"ajaxSubmitComplete";r==="dialog"?i==="success"&&$(`<div>${t.responseText}</div>`).dialog():typeof window[r]=="function"&&window[r](n,t,i)});return this};$.fn.ajaxClick=function(n={}){this.on("click",t=>{t.preventDefault();var i=$(t.currentTarget),r=$.extend({url:i.attr("href"),complete:(n,t)=>{i.trigger("ajaxClick",[n,t])}},n);$.ajax(r)}).on("ajaxClick",(n,t,i)=>{n.preventDefault();var r=$(n.currentTarget).attr("rel")||"ajaxClick";r==="dialog"?i==="success"&&$(`<div>${t.responseText}</div>`).dialog():typeof window[r]=="function"&&window[r](n,t,i)});return this};$.fn.dialog=function(n){var r=$(this==null||this.length==0?"<p>Nothing to display<\/p>":$("<div>").append(this)),t=$.extend({},{title:"Modal window",content:r},n),i;window.dialog?(window.dialog.find("div.header").html(t.title),window.dialog.find("div.content").html(t.content.html())):(i=$(`<div class="ui large modal"><i class="close icon"></i><div class="header">${t.title}</div>`+`<div class="scrolling content">${t.content.html()}</div>`+`<div class="actions"><div class="ui button deny">Cancel</div><button class="ui button green submit">OK</button></div>`+`</div>`),window.dialog=i.modal({closable:!1,transition:"horizontal flip",onVisible:function(){var t=$(this),n=t.find("form");n.length&&(n.ajaxSubmit(),n.find("a[data-request=ajax]").ajaxClick(),t.find("button.submit").attr("form",n.attr("id")))},onHidden:function(){$(this).find("div.content").empty()}}));window.dialog.modal("show")};$.fn.message=function(n){var t=$.extend({},{title:"",content:"",status:"info"},n),i=`<div class='ui floating ${t.status} message'><i class='close icon'></i> <div class='header'>${t.title}</div><p>${t.content}</p></div>`;$(i).appendTo("body").delay(1500).remove()};$.fn.formatCurrency=function(n){return"$"+n.toFixed(2).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")};$.fn.formatLink=function(n){return n==null?"":`<a href='${n}'target="_blank"><i class="fa fa-external-link-alt mr-1"></i>${n}</a>`};$.fn.formatDate=function(n){return n==null?"":new Date(n).toLocaleDateString()};$.fn.renderDatatableAction=function(n){return`<div class='ui fitted slider checkbox'><input type='checkbox' name='Id[]' value='${n}'> <label></label></div>`};$.fn.addField=function(n){$.get("/api/section/getfieldtypes",{cache:!0}).done(t=>{var i=$(`<div class="inline fields">
            <div class="eight wide field required">
                <input name="Fields[][Name]" required placeholder="Name" />
            </div>
            <div class="four wide field required" placeholder="Parent">
                <select name="Fields[][Type]" data-value-type="number" required >
                    ${t.map(n=>`<option value=${n.id}>${n.title}</option>`)}
                </select>
            </div>
            <div class="three wide field">
                <div class="ui toggle checkbox">
                    <input name="Fields[][IsRequired]" type="checkbox" data-value-type="boolean" tabindex="0" >
                    <label>Is Required</label>
                </div>
            </div>
            <div class="one wide field">
                <a href="#">delete</a>
            </div>
        </div>`);i.find("a").on("click",n=>{n.preventDefault(),i.remove()});i.appendTo(n)})};$(document).ready(()=>{$(".masthead").visibility({once:!1,onBottomPassed:function(){$(".fixed.menu").transition("fade in")},onBottomPassedReverse:function(){$(".fixed.menu").transition("fade out")}}),$("form[data-request=ajax]").ajaxSubmit(),$("a[data-request=ajax]").ajaxClick()}).ajaxSend(()=>{}).ajaxStart(()=>{$("form fieldset").attr("disabled","disabled")}).ajaxStop(()=>{$("form fieldset").removeAttr("disabled")}).ajaxError((n,t)=>{window.console.log("Error",t.responseText)});$.extend(!0,$.fn.dataTable.defaults,{toolbar:"#toolbar",dom:`<'ui stackable grid'<'row'<'eight wide column'<'dt-toolbar'>><'right aligned four wide column'l><'right aligned four wide column'f>><'row dt-table'<'sixteen wide column'tr>><'row'<'seven wide column'i><'right aligned nine wide column'p>>>`,searching:!0,ordering:!1,processing:!0,serverSide:!0,searchDelay:3500,autoWidth:!1,mark:!0,rowId:function(n){return"row_"+n.id},language:{search:"_INPUT_",searchPlaceholder:"Search..."},fnInitComplete:function(){$($.fn.dataTable.defaults.toolbar).appendTo($("div.dt-toolbar"))}});$.extend($.serializeJSON.defaultOptions,{parseNumbers:!0,useIntKeysAsArrayIndex:!1,customTypes:{"string:nullable":function(n){return n||null},"number:nullable":function(n){return Number(n)||null}}});